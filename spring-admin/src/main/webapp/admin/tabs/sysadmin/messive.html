<style type="text/css">
#messive_form {
margin: 0;
padding: 10px 30px;
}

.messive_item {
margin-bottom: 5px;
}

.messive_item label {
display: inline-block;
width: 80px;
}
</style>

<script type="text/javascript" src="../resources/js/common.js"></script>
<script type="text/javascript">
var userTable = 'user';

$(function() {
	initDataGrid('#messive_grid', appName + 'search/' + userTable + '.json');
});

function doSearchUser() {
	searchDataGrid('#messive_grid', {
		cellPhone : $('#messive_text').val()
	});
}

function doRefreshUser() {
	refreshDataGrid('#messive_grid', {
		cellPhone : ''
	});
}

function formatGender(val, row){
	var value = val;
	if(val == 'F'){
		value = '女'
	}else if(val == 'M'){
		value = '男'
	}
	
	return value;
}

function doPostEditUser(row){
	if(row.gender == 'F'){
		$('#messive_female').attr('checked', 'checked1');
	}else if(row.gender == 'M'){
		$('#messive_male').attr('checked', 'checked');
	}else{
		$('#messive_female').removeAttr('checked');
		$('#messive_male').removeAttr('checked');
	}
}

function showPushUserMessageDialog(){
	var rows = $('#messive_grid').datagrid('getSelections');

	if(!rows || rows.length == 0){
		showWarningMessage('请至少选择一行');
	}else{
		$('#messive_push_content').val('');
		$('#messive_push_title').val('');
		
		$('#messive_push_dlg').dialog({
			title: '发送消息',
			modal: true
		});
		
		$('#messive_push_dlg').dialog('open');
	} 	
}

function doPushUserMessage(jcntId){
	var form = new Object();
	form.title = $('#messive_push_title').val();
	form.text = $('#messive_push_content').val();
	form.userId = localStorage.userId;	
	
	var rows = $('#messive_grid').datagrid('getSelections');
   	var ids = '';
   	for(var i = 0; i < rows.length; i++){
   		ids += rows[i].id + ',';
   	}
   	ids = ids.substring(0, ids.length - 1);
   	console.log(ids);
   	
   	form.targetUserIds = ids;
   	push(form, 'broadcast/messive.json');
   	
   	//closeDialog('#messive_push_dlg');
}
</script>
<table id="messive_grid" class="easyui-datagrid" style="width:700px;height:250px" data-options="toolbar:'#messive_toolbar'">
    <thead>
        <tr>
        <th data-options="field:'ck'" checkbox="true"></th>
            <th data-options="field:'id'">ID</th>
            <th data-options="field:'cellPhone'">手机号</th>
            <th data-options="field:'phone'">固话</th>
            <th data-options="field:'name'">姓名</th>
            <th data-options="field:'gender',formatter:formatGender">性别</th>
            <th data-options="field:'zone'">所在地区</th>
            <th data-options="field:'address'">地址</th>
            <th data-options="field:'comment'">备注</th>
        </tr>
    </thead>
</table>
<div id="messive_toolbar" style="padding:5px;height:auto">
    <div style="margin-bottom:5px">
<!--         <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="showAddDialog('#messive_form', '#messive_dlg')">添加</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="showEditDialog('#messive_grid', '#messive_form', '#messive_dlg', null, doPostEditUser)">编辑</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-reload" plain="true" onclick="doRefreshUser()">刷新</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="deleteItem('#messive_grid', userTable)">删除</a> -->
    </div>
        <!-- 手机号 <input id="messive_text" class="easyui-numberbox" data-options="min:0,precision:0"/> -->
  	手机号 <input id="messive_text" type="text"/>
        <a href="#" class="easyui-linkbutton" iconCls="icon-search" onclick="doSearchUser()">查询</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="clearCriteria('#messive_toolbar')">清除</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-large-smartart" onclick="showPushUserMessageDialog()">发送</a>
</div>

<div id="messive_dlg" class="easyui-dialog" style="width:400px;height:400px;padding:10px 20px" closed="true" buttons="#messive_dlg_buttons">
     <form id="messive_form" method="post" novalidate>
         <div class="messive_item">
             <label>手机号</label>
             <input name="cellPhone" >
             <input name="id" type="hidden">
         </div>
         <div class="messive_item">
             <label>固话</label>
             <input name="phone" >
         </div>
         <div class="messive_item">
             <label>姓名</label>
             <input name="name" >
         </div>
         <div class="messive_item">
             <label>性别</label>
             <input id="messive_male" name="gender" type="radio" value="M">男
             <input id="messive_female" name="gender" type="radio" value="F">女
         </div>
         <div class="messive_item">
             <label>所在地区</label>
             <input name="zone" >
         </div>
         <div class="messive_item">
             <label>地址</label>
             <input name="address" >
         </div>
         <div class="messive_item">
             <label>备注</label>
             <input name="comment" >
         </div>
     </form>
 </div>
 <div id="messive_dlg_buttons">
     <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" onclick="saveItem('#messive_grid', '#messive_form', '#messive_dlg', userTable)">保存</a>
     <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="closeDialog('#messive_dlg')">取消</a>
 </div>

<div id="messive_push_dlg" class="easyui-dialog" style="width:700px;height:300px;padding:10px 20px" closed="true">
	<input id="messive_push_title" type="text" placeholder="标题" size="40"/><br/>
	<textarea id="messive_push_content" rows=10 cols=80></textarea><br/>
	<input type="button" value="发送" onclick="doPushUserMessage()">
	<input type="button" value="清空" onclick="clearInput('#messive_push_content')">
</div>